{"name": "client-registration-invalid-token", "description": "RegisterClient RPC rejects invalid JWT tokens", "given": "An invalid or expired JWT token", "when": "Calling RegisterClient with a valid fingerprint", "then": "Returns Unauthenticated error with 'invalid or expired token' message", "validates": ["authentication", "security"]}
{"name": "client-registration-empty-fingerprint", "description": "RegisterClient RPC rejects empty fingerprint", "given": "A valid JWT token", "when": "Calling RegisterClient with empty fingerprint", "then": "Returns InvalidArgument error", "validates": ["input-validation"]}
{"name": "client-registration-malformed-fingerprint", "description": "RegisterClient RPC rejects non-hex fingerprints", "given": "A valid JWT token", "when": "Calling RegisterClient with non-hex fingerprint like 'not-a-real-fingerprint'", "then": "Returns InvalidArgument error mentioning hex requirement", "validates": ["input-validation"]}
{"name": "client-registration-short-fingerprint", "description": "RegisterClient RPC rejects fingerprints that are not 64 hex characters", "given": "A valid JWT token", "when": "Calling RegisterClient with a 32-character hex fingerprint", "then": "Returns InvalidArgument error mentioning '64 hex characters'", "validates": ["input-validation"]}
{"name": "client-registration-fresh-key", "description": "RegisterClient RPC successfully registers a new client key", "given": "A valid JWT token from device linking and a new SSH key fingerprint", "when": "Calling RegisterClient with the fingerprint and display name", "then": "Returns principalId and status='approved'", "validates": ["registration", "happy-path"]}
{"name": "client-registration-duplicate-key", "description": "RegisterClient RPC detects already registered keys", "given": "A valid JWT token and a fingerprint that was already registered", "when": "Calling RegisterClient with the same fingerprint again", "then": "Returns AlreadyExists error", "validates": ["idempotency", "duplicate-detection"]}
{"name": "client-registration-empty-display-name", "description": "RegisterClient RPC rejects empty display names", "given": "A valid JWT token and valid fingerprint", "when": "Calling RegisterClient with empty display_name", "then": "Returns InvalidArgument error", "validates": ["input-validation"]}
{"name": "client-registration-rate-limit", "description": "RegisterClient RPC enforces rate limiting", "given": "A valid JWT token making rapid registration requests", "when": "Exceeding 5 registrations per minute", "then": "Returns ResourceExhausted error with 'rate limit exceeded' message", "validates": ["rate-limiting", "security"]}
{"name": "coven-chat-doctor-connectivity", "description": "coven-chat doctor command verifies gateway connectivity and authentication", "given": "A registered client key and valid configuration", "when": "Running 'coven-chat doctor'", "then": "Shows 'Health check... OK' and 'Fetching agents... OK'", "validates": ["end-to-end", "connectivity"]}
{"name": "standalone-agent-creates-file", "description": "Agent receives message via gateway HTTP API and creates a file using Write tool", "given": ["Agent running with DirectCliBackend in workspace", "Gateway accessible at coven.porpoise-alkaline.ts.net", "Agent registered and connected to gateway"], "when": ["HTTP POST /api/send with agent_id, content, sender fields"], "then": ["Gateway accepts message (returns thread_id in SSE stream)", "Agent receives message and logs 'Received message'", "Agent uses Write tool to create file", "File exists on filesystem with expected content", "Agent sends done event with full_response"], "validates": ["gateway-http-api", "agent-message-routing", "direct-cli-backend", "write-tool-execution", "sse-response-streaming"]}
{"name": "swarm-multi-agent-parallel", "description": "Multiple swarm agents can receive and execute tasks in parallel", "given": ["Swarm supervisor running with multiple workspace agents", "Each agent registered with unique agent_id pattern prefix_workspace", "Gateway accessible"], "when": ["Messages sent to different workspace agents concurrently"], "then": ["Each agent receives its respective message", "Tasks execute in parallel without blocking each other", "Each agent creates expected output in its workspace"], "validates": ["swarm-supervisor", "multi-agent-parallel-execution", "agent-isolation-per-workspace"]}
