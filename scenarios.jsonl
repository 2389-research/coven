{"name": "client-registration-invalid-token", "description": "RegisterClient RPC rejects invalid JWT tokens", "given": "An invalid or expired JWT token", "when": "Calling RegisterClient with a valid fingerprint", "then": "Returns Unauthenticated error with 'invalid or expired token' message", "validates": ["authentication", "security"]}
{"name": "client-registration-empty-fingerprint", "description": "RegisterClient RPC rejects empty fingerprint", "given": "A valid JWT token", "when": "Calling RegisterClient with empty fingerprint", "then": "Returns InvalidArgument error", "validates": ["input-validation"]}
{"name": "client-registration-malformed-fingerprint", "description": "RegisterClient RPC rejects non-hex fingerprints", "given": "A valid JWT token", "when": "Calling RegisterClient with non-hex fingerprint like 'not-a-real-fingerprint'", "then": "Returns InvalidArgument error mentioning hex requirement", "validates": ["input-validation"]}
{"name": "client-registration-short-fingerprint", "description": "RegisterClient RPC rejects fingerprints that are not 64 hex characters", "given": "A valid JWT token", "when": "Calling RegisterClient with a 32-character hex fingerprint", "then": "Returns InvalidArgument error mentioning '64 hex characters'", "validates": ["input-validation"]}
{"name": "client-registration-fresh-key", "description": "RegisterClient RPC successfully registers a new client key", "given": "A valid JWT token from device linking and a new SSH key fingerprint", "when": "Calling RegisterClient with the fingerprint and display name", "then": "Returns principalId and status='approved'", "validates": ["registration", "happy-path"]}
{"name": "client-registration-duplicate-key", "description": "RegisterClient RPC detects already registered keys", "given": "A valid JWT token and a fingerprint that was already registered", "when": "Calling RegisterClient with the same fingerprint again", "then": "Returns AlreadyExists error", "validates": ["idempotency", "duplicate-detection"]}
{"name": "client-registration-empty-display-name", "description": "RegisterClient RPC rejects empty display names", "given": "A valid JWT token and valid fingerprint", "when": "Calling RegisterClient with empty display_name", "then": "Returns InvalidArgument error", "validates": ["input-validation"]}
{"name": "client-registration-rate-limit", "description": "RegisterClient RPC enforces rate limiting", "given": "A valid JWT token making rapid registration requests", "when": "Exceeding 5 registrations per minute", "then": "Returns ResourceExhausted error with 'rate limit exceeded' message", "validates": ["rate-limiting", "security"]}
{"name": "coven-chat-doctor-connectivity", "description": "coven-chat doctor command verifies gateway connectivity and authentication", "given": "A registered client key and valid configuration", "when": "Running 'coven-chat doctor'", "then": "Shows 'Health check... OK' and 'Fetching agents... OK'", "validates": ["end-to-end", "connectivity"]}
